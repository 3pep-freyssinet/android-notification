<html>
  <head>
    <title>Cloudflare Turnstile Demo</title>

    <!-- Auto-rendering enabled by default -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoaded" async defer></script>

    <script type="text/javascript">
      let turnstileIsReady = false;
      let turnstileWidgetId = null;

      function onCaptchaSuccess(token) {
        if (window.HCaptchaInterface && HCaptchaInterface.onCaptchaSuccess) {
          HCaptchaInterface.onCaptchaSuccess(token);
        }
      }

      function onCaptchaError() {
        if (window.HCaptchaInterface && HCaptchaInterface.onCaptchaError) {
          HCaptchaInterface.onCaptchaError();
        }
      }

      function onTurnstileLoaded() {
        turnstileIsReady = true;

        // Grab widget ID after auto-render
        const container = document.getElementById('cf-turnstile');
        turnstileWidgetId = turnstile.getWidgetId(container);

        if (window.HCaptchaInterface && HCaptchaInterface.onTurnstileReady) {
          HCaptchaInterface.onTurnstileReady();
        }
      }

      function resetTurnstileWidget() {
        if (turnstileIsReady && turnstileWidgetId !== null) {
          turnstile.reset(turnstileWidgetId);
        } else {
          console.warn("Cannot reset: Turnstile not ready or widget ID missing.");
        }
      }
    </script>
  </head>

  <body>
    <form method="POST" action="">
      <div id="cf-turnstile" class="cf-turnstile"
           data-sitekey="CLOUDFLARE_SITE_KEY"
           data-callback="onCaptchaSuccess"
           data-error-callback="onCaptchaError"
           data-retry="auto">
      </div>
    </form>
  </body>
</html>
