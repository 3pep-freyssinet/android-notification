<html>
<head>
  <script type="text/javascript">
    let turnstileWidgetId = null;
    let turnstileIsReady = false;

    function onCaptchaSuccess(token) {
      console.log("Captcha success:", token);
      window.HCaptchaInterface?.onCaptchaSuccess?.(token);
    }

    function onCaptchaError() {
      console.log("Captcha error");
      window.HCaptchaInterface?.onCaptchaError?.();
    }

    function onTurnstileLoaded() {
      console.log("Turnstile loaded");
      turnstileIsReady = true;

      // Render only once, using JS
      turnstileWidgetId = turnstile.render('#cf-turnstile', {
        sitekey: '0x4AAAAAABipTppMFYkyCGsB', // <-- your actual site key
        callback: onCaptchaSuccess,
        'error-callback': onCaptchaError
      });

      try {
        //window.HCaptchaInterface?.onTurnstileReady?.();
      } catch (e) {
        console.error("Java exception in onTurnstileReady:", e);
      }
    }

    function resetTurnstileWidget() {
      if (turnstileIsReady && turnstileWidgetId !== null) {
        console.log("Resetting widget with ID:", turnstileWidgetId);
        turnstile.reset(turnstileWidgetId);
      } else {
        console.warn("Turnstile not ready or widgetId missing");
      }
    }
  </script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoaded&render=explicit" async defer></script>
</head>

<body>
  <!-- No data-sitekey, this is for manual rendering only -->
  <div id="cf-turnstile"></div>
</body>
</html>
