<html>
  <head>
    <title>Cloudflare Turnstile Demo</title>
    
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script> 
    <script type="text/javascript">
        function onCaptchaSuccess(token) {
            // Pass the Turnstile token to Android
            //'HCaptchaInterface' is the interface name used in android. cf 'LoginActivity.oncreate' : 
            // captcha.addJavascriptInterface(new HCaptchaInterface(this, client, progressBar, captchaStatus), "HCaptchaInterface");
            
            HCaptchaInterface.onCaptchaSuccess(token); // Keep the interface name if used by Android

            //alert("document.getElementById('submit') : " + document.getElementById('submit'));
            alert("Hello the World"); 
            // Enable the submit button
            //document.getElementById('submit').disabled = false;
        }

        function onCaptchaError() {
            console.log("Captcha failed");
            HCaptchaInterface.onCaptchaError(); // Keep consistent if Android depends on this
        }
    </script>
    
  </head>
  <body>
    <form action="" method="POST">
      <!--
      <input type="text" name="email" placeholder="Email" />
      <input type="password" name="password" placeholder="Password" />
      -->
      
      <!-- The KEY is filled at runtime from the environment. See 'index.js' -->
      
      <div class="cf-turnstile"
           data-sitekey="CLOUDFLARE_SITE_KEY"
           data-callback="onCaptchaSuccess"
           data-error-callback="onCaptchaError"
           data-retry="auto">
      </div>
      <script>
      function notifyAndroidLoaded() {
        if (window.HCaptchaInterface && HCaptchaInterface.onTurnstileReady) {
            HCaptchaInterface.onTurnstileReady(); // Java â†’ progressBar.setVisibility(View.GONE)
        }
      }

      const observer = new MutationObserver(() => {
        const iframe = document.querySelector("iframe[src*='turnstile']");
        if (iframe && iframe.complete) {
            notifyAndroidLoaded();
            observer.disconnect(); // Done observing
        }
       });

       window.onload = function () {
        observer.observe(document.body, { childList: true, subtree: true });

        // Also fallback: poll in case iframe doesn't trigger mutation
        const interval = setInterval(() => {
            const iframe = document.querySelector("iframe[src*='turnstile']");
            if (iframe && iframe.complete) {
                notifyAndroidLoaded();
                clearInterval(interval);
            }
        }, 100);
       };
       </script>

      <!--
      <br />
      <input id="submit" type="submit" value="Submit" disabled/>
      -->
    </form>
    
  </body>
</html>
