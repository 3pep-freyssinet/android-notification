<html>
  <head>
    <title>Cloudflare Turnstile Demo</title>

    <!-- Load Turnstile API -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoaded" async defer></script>

    <script type="text/javascript">
      let turnstileIsReady = false;
      let turnstileWidgetId = null;

      function onCaptchaSuccess(token) {
        if (window.HCaptchaInterface && HCaptchaInterface.onCaptchaSuccess) {
          HCaptchaInterface.onCaptchaSuccess(token);
        }
      }

      function onCaptchaError() {
        if (window.HCaptchaInterface && HCaptchaInterface.onCaptchaError) {
          HCaptchaInterface.onCaptchaError();
        }
      }

      function onTurnstileLoaded() {
        turnstileIsReady = true;

        // Manually render and store widget ID
        turnstileWidgetId = turnstile.render('#cf-turnstile', {
          sitekey: 'CLOUDFLARE_SITE_KEY', // <-- Replace this with real key from Android
          callback: onCaptchaSuccess,
          'error-callback': onCaptchaError,
          retry: 'auto'
        });

        if (window.HCaptchaInterface && HCaptchaInterface.onTurnstileReady) {
          HCaptchaInterface.onTurnstileReady();
        }
      }

      function resetTurnstileWidget() {
        if (turnstileIsReady && turnstileWidgetId !== null) {
          turnstile.reset(turnstileWidgetId);
        } else {
          console.warn("Turnstile not ready or widgetId missing.");
        }
      }
    </script>
  </head>

  <body>
    <form method="POST" action="">
      <div id="cf-turnstile"></div>
    </form>
  </body>
</html>
